---
title: "[Unity]åºŠã®é¡é¢åå°„ã«ã¤ã„ã¦"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Unity"]
published: true
---

# ReflectionProbeã«ã¤ã„ã¦
Unityã§ã¯åå°„ã‚’å†ç¾ã™ã‚‹ã®ã«ReflectionProbe(ä»¥ä¸‹ãƒ—ãƒ­ãƒ¼ãƒ–)ã¨ã„ã†æ©Ÿèƒ½ã‚’ç”¨ã„ã¾ã™ï¼  
é€šå¸¸ï¼Œãƒ—ãƒ­ãƒ¼ãƒ–ã‚’ä½¿ã†å ´åˆï¼Œåå°„ã‚’ã•ã›ãŸã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½ç½®ã¨åŒã˜ä½ç½®ã«ãƒ—ãƒ­ãƒ¼ãƒ–ã‚’ç½®ãã¾ã™ï¼  

![ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ¼ãƒ–ã®è¨­ç½®ä¾‹](https://storage.googleapis.com/zenn-user-upload/00bpmkmo6iwbn2o9fddoooj20e6k)
![ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ¼ãƒ–ã®åå°„ä¾‹](https://storage.googleapis.com/zenn-user-upload/5gkaoteyg5wythfhukwyyax5b8ql)
å°ç‰©ãªã©ã®å ´åˆã¯ã“ã®æ–¹æ³•ã§åå°„ã¯ãã‚Œãªã‚Šã«æ­£ã—ã„è¦‹ãŸç›®ã¨ã—ã¦åæ˜ ã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ï¼  
ã—ã‹ã—ï¼Œå¹³é¢ç­‰ã§æ§‹æˆã•ã‚Œã‚‹åºŠã«ä¸Šè¨˜ã®æ–¹æ³•ã§åå°„ã‚’é©ç”¨ã—ãŸå ´åˆï¼Œç ´ç¶»ãŒã‹ãªã‚Šç›®ç«‹ã¡ã¾ã™ï¼
Planeã®åå°„ã«å¯¾ã—ã¦â†“ç”»åƒã¿ãŸã„ã«ãƒ—ãƒ­ãƒ¼ãƒ–ã‚’ç½®ãã¨...  
![Planeã«ãƒ—ãƒ­ãƒ¼ãƒ–ã‚’ç½®ã„ãŸç”»åƒ](https://storage.googleapis.com/zenn-user-upload/o9ckeqla1wigo9feskeyx4b5xe8w)
çµæœã¨ã—ã¦æ­£ã—ããªã„åå°„ãŒå†™ã‚Šã“ã‚€  
ç”»åƒå³å´ã«é–¢ã—ã¦ã¯ã»ã¨ã‚“ã©ãŒè»Šã®åå°„ã§è¦†ã„éš ã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹.  
![æ­£ã—ããªã„åå°„](https://storage.googleapis.com/zenn-user-upload/w1tg6xt1cznwk9jivlsfoq9qx4d0)

# ãƒ—ãƒ­ãƒ¼ãƒ–ã®ä½ç½®ã‚’å¤‰ãˆã¦å¯¾ç­–ã™ã‚‹  
è§£æ±ºæ³•ã«é–¢ã—ã¦ã¯[ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°è¨˜äº‹](http://karanokan.info/2018/10/17/post-1284/)ã‚’å‚è€ƒã«ã—ã¾ã—ãŸï¼
è¦ã¯åå°„é¢ã‚’è»¸ã«å¯¾ç§°ã®ä½ç½®ã«ãƒ—ãƒ­ãƒ¼ãƒ–ã‚’ç½®ã‘ã°ã„ã„ã‚ˆã†ã§ã™ï¼  
![ä»•çµ„ã¿](https://storage.googleapis.com/zenn-user-upload/xf7o77b1kjvad5yh1xq5hnrxcekz)   
ã‚¤ãƒ©ã‚¹ãƒˆã‚’ç”¨æ„ã™ã‚‹ã®ãŒå¤§å¤‰ã ã£ãŸã®ã§  
https://community.arm.com/developer/tools-software/graphics/b/blog/posts/combined-reflections-stereo-reflections-in-vr  
ã“ã¡ã‚‰ã‹ã‚‰æ‹å€Ÿã•ã›ã¦é ‚ãã¾ã—ãŸ...  
ãƒ–ãƒ­ã‚°è¨˜äº‹ã§ã‚‚å®Ÿè£…ãŒã‚ã‚Šã¾ã™ã—ï¼Œãªã‚“ãªã‚‰ãƒ—ãƒ­ãƒ¼ãƒ–ã‚’ä½¿ã‚ãªã„æ–¹æ³•ãªã‚“ã‹ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼Œä¸€åº¦è¦‹ã¦ã¿ã‚‹ã®ã‚’ãŠã™ã™ã‚ã—ã¾ã™ï¼  
ã—ã‹ã—ï¼Œåˆå¿ƒè€…ãŒãƒãƒã‚‹ã‹ã‚‚ã—ã‚Œãªã„ç‚¹ã¨ã—ã¦Plane(åå°„é¢)ã®yåº§æ¨™ãŒ0ã§ã‚ã‚‹ã®ãŒå‰æã®å®Ÿè£…ã ã£ãŸã®ã§ï¼Œæœ¬è¨˜äº‹ã§ã¯ãã‚Œã«å¯¾å¿œã—ãŸã‚‚ã®ã‚’ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼  

```csharp
using UnityEngine;
using System.Collections;
 
public class setProbePosition: MonoBehaviour
{

    [SerializeField]
    public GameObject plane;//é¡é¢åå°„ã‚’è¡Œã†Plane
    private ReflectionProbe probe;
    private Transform trfMainCam;
    private Transform trfPlane;

    void Start()
    {
        probe = gameObject.GetComponent<ReflectionProbe>();
        trfMainCam = Camera.main.transform;
    }

    void Update()
    {
        //å·®åˆ†è·é›¢å°å‡º
        float _diffDistance = GetDiffDistance();
        SetPosition(_diffDistance);
    }

    private void SetPosition(float _diffDist)
    {
        probe.transform.position = new Vector3(trfMainCam.position.x, trfMainCam.position.y - (_diffDist * 2.0f), trfMainCam.position.z);
    }

    private float GetDiffDistance()
    {
        float _dist =  Mathf.Abs(trfMainCam.position.y - plane.transform.position.y);
        if (trfMainCam.position.y < plane.transform.position.y)
        {
            //ã‚«ãƒ¡ãƒ©ã‚ˆã‚Šä¸Šã«å¹³é¢ãŒã‚ã£ãŸå ´åˆã«probeã¨ã®ä½ç½®ãŒé€†è»¢ã™ã‚‹ãŸã‚ã®å¯¾ç­–
            _dist *= -1.0f;
        }

        return _dist;
    }
}
```
ä½œæˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’åå°„ã•ã›ãŸã„planeã®ãƒ—ãƒ­ãƒ¼ãƒ–ã«é©ç”¨ã—ã¦ï¼Œã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ã‹ã‚‰å¯¾è±¡ã¨ã™ã‚‹planeã‚’æŒ‡å®šã—ã¦ã‚„ã‚Œã°ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ã€€ã€€

é–¢æ•°ã«ã¾ã¨ã‚ãŸã‚Šã—ãŸã®ã§è‹¥å¹²å®Ÿè£…ãŒé•ã„ã¾ã™ãŒï¼Œãƒ–ãƒ­ã‚°è¨˜äº‹ã¨é•ã†éƒ¨åˆ†ã¯probeã®yåº§æ¨™ã‚’æ±ºå®šã™ã‚‹ã®ã«ï¼Œã‚«ãƒ¡ãƒ©ã®-1yåº§æ¨™ã¨ã—ã¦ã„ãŸéƒ¨åˆ†ã§ã™ï¼  
`-trfMainCam.position.y` ã“ã®éƒ¨åˆ†ã‚’  
`trfMainCam.position.y - (_diffDist * 2.0f)`  
ã«å¤‰æ›´ã—ã¦ã„ã¾ã™ï¼  
`_diffDist`ã¯ã‚«ãƒ¡ãƒ©ã¨planeã¨ã®yè»¸ä¸Šã®å·®åˆ†è·é›¢ãŒ`GetDiffDistance()`ã§è¨ˆç®—ã•ã‚Œã¦ã„ã¾ã™ï¼åŸºæœ¬çš„ã«ã¯ã‚«ãƒ¡ãƒ©ã¨planeã¨ã§æ¸›ç®—ã‚’ã—ã¦ã„ã‚‹ã ã‘ã§ã™ï¼  
ãŸã ã—ï¼Œå¹³é¢ãŒå¤©äº•ã®ã‚ˆã†ã«ã‚«ãƒ¡ãƒ©ã®ä¸Šã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ç®—å‡ºå€¤ã‚’ãã®ã¾ã¾ä½¿ã†ã¨ãƒ—ãƒ­ãƒ¼ãƒ–ã¨ã®ä½ç½®é–¢ä¿‚ãŒãŠã‹ã—ããªã£ã¦ã—ã¾ã†ã®ã§`-1.0`ã‚’ä¹—ç®—ã™ã‚‹ã“ã¨ã§å¯¾ç­–ã—ã¦ã„ã¾ã™ï¼  
ã‚ã¨ã¯ã‚«ãƒ¡ãƒ©ã®yåº§æ¨™ã¨`_diffDist`ã‚’2å€ã—ãŸã‚‚ã®ã‚’æ¸›ç®—ã—ã¦ã‚„ã‚Œã°ï¼Œå¸¸ã«ã‚«ãƒ¡ãƒ©ã¨planeã®ä½ç½®ã«å¯¾å¿œã—ãŸä½ç½®ã«ãƒ—ãƒ­ãƒ¼ãƒ–ãŒç§»å‹•ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼  
ã“ã‚Œã®ãƒ¡ãƒªãƒƒãƒˆã«ã¯ï¼Œplaneã®yåº§æ¨™ãŒ0ã§ãªã„ã¨ãã¯ã‚‚ã¡ã‚ã‚“ï¼Œã‚²ãƒ¼ãƒ ä¸­ã®ç§»å‹•åºŠãªã©ã§ã‚‚åå°„ã®ç ´ç¶»ãŒãªããªã‚‹ã“ã¨ãŒã‚ã’ã‚‰ã‚Œã¾ã™ï¼  

# çµæœ
è‰¯ã„æ„Ÿã˜  
![çµæœ](https://storage.googleapis.com/zenn-user-upload/ev65zz7hwovvba0u46m7yid8odj3)

# æœ€å¾Œã«
å®Ÿã¯ã“ã®å®Ÿè£…ã ã‘ã ã¨è¶³ã‚Šãªã„å‡¦ç†ã«ï¼Œplaneã®ä¸Šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒplaneã‚’è²«é€šã—ã¦ã„ãŸã‚Šã™ã‚‹ã¨ï¼Œãƒ—ãƒ­ãƒ¼ãƒ–ãŒè²«é€šã—ãŸéƒ¨åˆ†ã«é–¢ã—ã¦ã‚‚åå°„ã¨ã—ã¦å–ã‚Šè¾¼ã‚“ã§ã—ã¾ã„ã¾ã™ï¼  
å…ˆã»ã©ã‚‚ç´¹ä»‹ã—ãŸ[ãƒ–ãƒ­ã‚°è¨˜äº‹](http://karanokan.info/2018/10/17/post-1284/)ã§ã¯ãƒ—ãƒ­ãƒ¼ãƒ–ã‚’ä½¿ã‚ãªã„æ–¹æ³•ã§å•é¡Œã®å¯¾ç­–ã‚’ã—ã¦ã„ã¾ã™ã®ã§ï¼Œã‚‚ã—ã‚‚ãã¡ã‚‰ã§å›°ã£ã¦ã„ãŸã‚‰ãƒ–ãƒ­ã‚°ã‚’è¦—ã„ã¦ã¿ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ï¼  
(ã»ã¨ã‚“ã©ãƒ–ãƒ­ã‚°è¨˜äº‹ã¨ä¸€ç·’ã§ã™ãŒä¼¼ãŸã‚ˆã†ãªè¨˜äº‹ãŒå°‘ãªã‹ã£ãŸã®ã§åˆå¿ƒè€…ãŒãŸã©ã‚Šã¤ãã‚„ã™ããªã‚‹æ„å‘³ã‚’å«ã‚ã¦æŠ•ç¨¿ã—ã¾ã—ãŸ)  